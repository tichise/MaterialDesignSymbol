name: CI

on:
  push:
    branches:
      - master
      - main
  pull_request:
    branches:
      - master
      - main

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  build:
    name: Build (${{ matrix.platform }})
    runs-on: macos-latest
    strategy:
      fail-fast: false
      matrix:
        platform: [iOS, watchOS]
        include:
          - platform: iOS
            destination: "platform=iOS Simulator,name=iPhone 15,OS=latest"
          - platform: watchOS
            destination: "platform=watchOS Simulator,name=Apple Watch Series 9 (45mm),OS=latest"

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Select Xcode
        run: sudo xcode-select -s /Applications/Xcode.app

      - name: Show Xcode version
        run: xcodebuild -version

      - name: Build Swift Package
        run: |
          xcodebuild build \
            -scheme MaterialDesignSymbol \
            -destination "${{ matrix.destination }}" \
            -skipPackagePluginValidation \
            | xcpretty || true

  swift-build:
    name: Swift Build
    runs-on: macos-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Select Xcode
        run: sudo xcode-select -s /Applications/Xcode.app

      - name: Build with Swift
        run: swift build

  pod-lint:
    name: CocoaPods Lint
    runs-on: macos-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Lint Podspec
        run: pod lib lint --allow-warnings
